<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NoFace Chess</title>
<link rel="stylesheet" href="https://unpkg.com/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
<style>
body { font-family: 'Segoe UI', sans-serif; background:#111; color:#fff; margin:0; padding:20px; display:flex; flex-direction:column; align-items:center; }
h1 { color:#FFD700; text-shadow:0 0 10px #000; }
button, select { margin:5px; padding:10px 15px; font-size:16px; border-radius:10px; cursor:pointer; border:none; background:linear-gradient(145deg,#FFD700,#B8860B); color:#111; font-weight:bold; }
#board { margin:20px auto; border:4px solid #FFD700; border-radius:12px; box-shadow:0 0 25px rgba(255,215,0,0.5); }
</style>
</head>
<body>

<!-- NOFACE IMAGE --> 
  <section class="relative flex flex-col items-center justify-center pt-10 pb-6 sm:pt-14 sm:pb-8 md:pt-18 md:pb-10 z-5"> 
    <picture> <source srcset="https://i.ibb.co/zVQ1hkzR/noface-coin.webp" type="image/webp"> 
      <img src="https://i.ibb.co/zVQ1hkzR/noface-coin.webp" alt="♟ NoFace Chess ♟" 
        class="w-48 sm:w-64 md:w-80 lg:w-96 mx-auto rounded-2xl shadow-[0_0_25px_#00ff00]/50" 
        loading="lazy" 
        decoding="async"> 
    </picture> 
  </section>
  
<!-- <h1>♟ NoFace Chess ♟</h1> --> 

<button id="connectWallet">Connect Wallet</button>

<select id="skill">
  <option value="1">Beginner</option>
  <option value="2">Intermediate</option>
  <option value="3">Advanced</option>
  <option value="4">Master</option>
</select>

<select id="time">
  <option value="60">1 Minute</option>
  <option value="300">5 Minutes</option>
  <option value="600">10 Minutes</option>
</select>

<button id="start">PLAY CHESS</button>

<div id="board"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
<script src="https://unpkg.com/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
<script src="https://unpkg.com/@solana/web3.js@1.67.0/lib/index.iife.min.js"></script>

<script>
let board, game, walletPublicKey;

// WebSocket connection to your live backend
const WS_URL = "wss://noface-chess-server.onrender.com"; // <-- change if different
const socket = new WebSocket(WS_URL);

// Listen for backend messages
socket.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if(data.action === "matched") alert("Matched with player " + data.opponent);
  if(data.action === "betSuccess") alert("1 NoFaceSol token bet confirmed!");
  if(data.action === "refund") alert("Stalemate! 90% of your token refunded.");
};

// Connect wallet (Phantom)
document.getElementById("connectWallet").onclick = async () => {
  if (!window.solana) return alert("Install Phantom Wallet!");
  const resp = await window.solana.connect();
  walletPublicKey = resp.publicKey.toString();
  alert("Wallet connected: " + walletPublicKey);
};

// Start chess game & send bet request
document.getElementById("start").onclick = () => {
  if(!walletPublicKey) return alert("Connect wallet first!");
  const skill = document.getElementById("skill").value;
  const time = parseInt(document.getElementById("time").value);

  // Send start game request to backend
  socket.send(JSON.stringify({ action: "startGame", wallet: walletPublicKey, skill, time }));

  game = new Chess();
  board = Chessboard('board', {
    draggable:true,
    position:'start',
    pieceTheme:(piece)=>'./img/'+piece+'.png',
    onDrop:(src,tgt)=>{
      const move = game.move({from:src, to:tgt, promotion:'q'});
      if(move===null) return 'snapback';
      board.position(game.fen());
      if(game.game_over()){
        const result = game.in_stalemate() ? 'stalemate' : 'win';
        socket.send(JSON.stringify({ action: "gameOver", wallet: walletPublicKey, result }));
        alert("Game Over: " + result);
      }
    }
  });
};
</script>
</body>
</html>
